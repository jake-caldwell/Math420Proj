---
title: "Math 420 Final Project"
author: "Riley Coburn"
date: "12/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require(mosaic)
require(agricolae) #possible desired package for LSD; will need to install first time around
require(Stat2Data)
require(car)
require(nortest)
require(fBasics) # needed for more advanced normality tests, e.g. D'Agostino's
```

```{r}
set.seed(10)
runs <- 100000

xs <- runif(runs,min=-0.5,max=0.5) #uniform distribution
ys <- runif(runs,min=-0.5,max=0.5) #uniform distribution

#we are randomly sampling from two uniform distributions

in.circle <- xs^2 + ys^2 <= 0.5^2 #calculating test statistic i.e. whether a randomly sampled point from our uniform distributions falls within the circle inscribed in the sampling distribution

#Empirically, A_square = (2r)^2 = 4r^2. Suppose we don't know a value for pi, but instead just know that A_circle is proportional to r^2. That is A_circle = cr^2. If we were to 

mc.pi <- (sum(in.circle)/runs)*4 #Finding proportion of points of the square that lie within the circle. We multiply by a factor of 4 because the proportion of areas is A_square/A_circle = 4r^2/cr^2 = 4/c meaning c = 4*A_circle/A_square. Here, A_cirle is just the number of points that we have inside the circle and A-square is just all points as the sampling distribution is a square. 
plot(xs,ys,pch='.',col=ifelse(in.circle,"blue","grey")
     ,xlab='',ylab='',asp=1,
     main=paste("MC Approximation of Pi =",mc.pi))
```
### Simple Randomization Based Inference using cancer survival data.

```{r}
Cancer = read.csv("http://personal.denison.edu/~whiteda/files/Teaching/CancerSurvival.csv") # reads in the data
fv = favstats(~Survival | Organ, data=Cancer) # provides summary stats for survival for each type of cancer in data
fv
bwplot(~Survival | Organ, data=Cancer, layout = c(1, 5)) # plots the distribution of survival for each type of cancer in a boxplot
```


```{r}
mod <- aov(Survival~Organ, data = Cancer) # generates our original model to get our original test stat
summary(mod) # summary of above model
plot(mod, which = 1) # plots residuals vs fitted values, check for equal variance
plot(mod, which = 2) # plots normal-qq, check for noramlly distributed residuals
leveneTest(mod) # Levene's test for equal variances of groups
shapiro.test(mod$residuals) # shapiro wilkes test for normality of residuals

```

Normality of residuals and equal variance conditions not met, so we will test for randomness:

```{r}
library(lawstat)
runs.test(Cancer$Survival)
bartels.test(Cancer$Survival)
```

We fail to reject the null hypothesis that the data is not normal, we can proceed with randomization based inference. 

```{r}
mod=lm(Survival~Organ,data=Cancer)# our original mod
anova(mod) # anova to determine utility
res=anova(mod)$"F value"# store the F statistics
t=do(1000)*(anova(lm(shuffle(Survival)~as.factor(Organ),data=Cancer))$"F value")# repeat above process 1000 times with shuffled response variable. 
t=as.data.frame(t)# generates a dataframe of the randomization distribution
densityplot(~V1, data=t) #plots this in a density plot
ladd(panel.abline(v=res[1], col="red", lwd=3)) #adds a line in for our original F-stat
results <- pdata(res[1],t$V1,data=t,lower.tail=FALSE) # generating the number of F-stats as or more extreme than our original
length(subset(results,results==0))/length(results) # empirical p-value
```

After 1000 permutations, we have come to the conclusion to reject the null hypothesis that the different types of cancers in the data set have the same mean survival rate. Our above randomization distribution essentially says our p-value given our original F-statistic is 0. 

## Testing the 
